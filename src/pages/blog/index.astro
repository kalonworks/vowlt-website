---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

// Get all blog posts, filter out drafts, sort by date
const allPosts = await getCollection("blog", ({ data }) => {
  return data.draft !== true;
});

const posts = allPosts.sort((a, b) => {
  return b.data.pubDate.getTime() - a.data.pubDate.getTime();
});
---

<BaseLayout
  title="Blog | vowlt"
  description="Follow along as we build vowlt in public. Updates, technical posts, and product development insights."
>
  <!-- Header -->
  <header class="border-b border-gray-200 dark:border-gray-700 py-6 px-6">
    <div class="max-w-4xl mx-auto flex justify-between items-center">
      <a href="/" class="text-2xl font-bold text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300">
        vowlt
      </a>
      <nav>
        <a href="/blog" class="text-gray-900 dark:text-gray-100 font-medium"> Blog </a>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-4xl mx-auto px-6 py-12">
    <div class="mb-12">
      <p class="text-xl text-gray-600 dark:text-gray-400">
        Building vowlt in public. Follow our journey from idea to launch.
      </p>
    </div>

    <!-- Blog Posts -->
    {
      posts.length === 0 ? (
        <div class="text-center py-12">
          <p class="text-gray-600 dark:text-gray-400 text-lg">No posts yet. Check back soon!</p>
        </div>
      ) : (
        <div class="space-y-6">
          {posts.map((post) => (
            <article class="group relative bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6 transition-all hover:shadow-lg hover:border-blue-300 dark:hover:border-blue-600">
              <a href={`/blog/${post.id}`} class="after:absolute after:inset-0 after:content-['']">
                <h2 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-gray-100 mb-3 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
                  {post.data.title}
                </h2>
              </a>
              <p class="relative z-[2] text-gray-600 dark:text-gray-400 mb-4">{post.data.description}</p>
              <div class="relative z-[2] flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400">
                <time datetime={post.data.pubDate.toISOString()}>
                  {post.data.pubDate.toLocaleDateString("en-US", {
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                  })}
                </time>
                {post.data.tags && post.data.tags.length > 0 && (
                  <div class="flex gap-2">
                    {post.data.tags.map((tag) => (
                      <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded text-xs">
                        {tag}
                      </span>
                    ))}
                  </div>
                )}
              </div>
            </article>
          ))}
        </div>
      )
    }
  </main>

  <!-- Footer -->
  <footer class="text-center py-8 px-6 border-t border-gray-200 dark:border-gray-700 mt-12">
    <p class="text-gray-600 dark:text-gray-400">
      Built by <a
        href="https://kalonworks.com"
        class="text-blue-600 dark:text-blue-400 hover:underline">kalonworks</a
      >
    </p>
  </footer>
</BaseLayout>
